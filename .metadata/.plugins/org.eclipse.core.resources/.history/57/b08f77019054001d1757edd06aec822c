/*
 * fsm_automatic.c
 *
 *  Created on: Oct 25, 2022
 *      Author: PC
 */


#include "fsm_automatic.h"

void fsm_automatic_run(){
	switch(status){
		case INIT:
			//TODO
			setRedLed1();
			status = AUTO_RED;
			lastState = status;
			setTimer1(red_duration);
			break;

		case AUTO_RED:
			//TODO
			setRedLed1();
			if(isTimer1Expired() == 1){
				setTimer1(green_duration);
				status = AUTO_GREEN;
			}

			if(isButtonPressed(0)){
				HAL_GPIO_TogglePin(GREEN2_GPIO_Port, GREEN2_Pin);
				lastState = status;
				status = MODIFY_RED;
				clearTimer1();
			}
			break;

		case AUTO_GREEN:
			//TODO
			setGreenLed1();
			if(isTimer1Expired() == 1){
				setTimer1(yellow_duration);
				status = AUTO_YELLOW;
			}

			if(isButtonPressed(0)){
				lastState = status;
				status = MODIFY_RED;
				clearTimer1();
			}
			break;

		case AUTO_YELLOW:
			//TODO
			setYellowLed1();
			if(isTimer1Expired() == 1){
				setTimer1(red_duration);
				status = AUTO_RED;
			}

			if(isButtonPressed(0)){
				lastState = status;
				status = MODIFY_RED;
				clearTimer1();
			}
			break;

		default:
			break;
	}
}
